<!-- <head>
	<link rel="stylesheet" href="matrices.css" />
</head> -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Web App</title>
    <link rel="stylesheet" href="/matrices.css">
	<style>
		.head {
			display: flex;
			justify-content: center;
			align-items: center;
			height: 50px; /* Adjust the height as needed */
		}
        table {
            border-collapse: collapse;
            width: 100%;
        }

        table, th, td {
            border: 1px solid black;
        }

        th, td {
            width: 25%;
            padding: 8px;
            text-align: left;
        }

        #summary-section {
            margin-top: 20px;
        }
		/* .item-container, .opt-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
        }

        .element {
            width: 100px;
            height: 100px;
            border: 1px solid #000;
        } */

        .submitbutton, .newtestbutton {
            margin-top: 20px;
        }
    </style>
</head>

<div class="root">
	<div class="head">
		<span id="current-turn">Turn: 1</span>


	</div>
	<div class="item-container">
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat1"
			ref="mat1"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat2"
			ref="mat2"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat3"
			ref="mat3"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat4"
			ref="mat4"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat5"
			ref="mat5"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat6"
			ref="mat6"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat7"
			ref="mat7"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat8"
			ref="mat8"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-item"
			id="mat9"
			ref="mat9"
		></svg>
	</div>
	<div class="opt-container">
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el0"
			@click="drawSymbol(0)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el1"
			@click="drawSymbol(1)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el2"
			@click="drawSymbol(2)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el3"
			@click="drawSymbol(3)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el4"
			@click="drawSymbol(4)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el5"
			@click="drawSymbol(5)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el6"
			@click="drawSymbol(6)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el7"
			@click="drawSymbol(7)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el8"
			@click="drawSymbol(8)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el9"
			@click="drawSymbol(9)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el10"
			@click="drawSymbol(10)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el11"
			@click="drawSymbol(11)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el12"
			@click="drawSymbol(12)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el13"
			@click="drawSymbol(13)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el14"
			@click="drawSymbol(14)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el15"
			@click="drawSymbol(15)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el16"
			@click="drawSymbol(16)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el17"
			@click="drawSymbol(17)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el18"
			@click="drawSymbol(18)"
		></svg>
		<svg
			viewBox="0 0 100 100"
			class="element e-opt"
			id="el19"
			@click="drawSymbol(19)"
		></svg>
	</div>
	<button id="submit" class="submitbutton" type="submit">CONTINUE</button>
	<input
		id="solution"
		typ="text"
		name="solution"
		size="20"
		hidden
		value="00000000000000000000"
	/>
	<input id="log" typ="text" name="log" hidden value="" />
</div>
<!-- Summary Section -->
<div id="summary-section" style="display: none;">
    <h2>Test Summary</h2>
    <table>
        <thead>
            <tr>
				<th>Questions Answered</th>
                <th>Standard Error</th>
                <th>Information</th>
				<th>Correctness</th>
                <th>Estimated Ability Levels</th>
            </tr>
        </thead>
        <tbody id="summary-table-body">
        </tbody>
    </table>
	<button id="new-test" class="newtestbutton" type="button">Start New Test</button>

</div>

<script src="/svg.js"></script>
<script src="/drawing.js"></script>
<script>
	var itemCode =
		"10100000000000000000,00110000000000000000,00100000000000000000,01010000000000000000,11000000000000000000,01000000000000000000,01100000000000000000,11000000000000000000,00000000000000000000";
	
		// Fetch the current turn and display it
	function updateTurn() {
        fetch('/api/turn', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => response.json())
        .then(data => {
            document.getElementById("current-turn").textContent = `Turn: ${data.cur_turn} ; Question ID: ${data.cur_id}`;
        });
    }
	fetch('/api/data', {
		method: 'GET',
		headers: {
			'Content-Type': 'application/json'
		}
	}).then(response => response.json())
	.then(data => {
		itemCode = data["data"];

		redrawItem(itemCode);
		updateTurn();
		});


	
    
    // Add click event listener for the submit button
	document.getElementById("submit").addEventListener("click", () => {
		const solution = document.getElementById("solution").value;
		const log = document.getElementById("log").value;
        fetch('/api/data', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({response: solution})
        }).then(response => response.json())
        .then(data => {
            if (data.summary) {
                displaySummary(data.summary);
            } else {
                redrawItem(data["data"]);
                resetSelection();
                updateTurn();
            }
        });
	});

	function displaySummary(summary) {
        document.querySelector(".item-container").style.display = "none";
        document.querySelector(".opt-container").style.display = "none";
        document.getElementById("submit").style.display = "none";
        document.getElementById("current-turn").style.display = "none";
        document.getElementById("summary-section").style.display = "block";
        
        let tableBody = document.getElementById("summary-table-body");
        tableBody.innerHTML = "";

        let maxLength = Math.max(
            summary.standard_error.length, 
            summary.information.length, 
            summary.q_answered_list.length, 
            summary.student_level_list.length,
			summary.result_correctness_list.length
        );

        for (let i = 0; i < maxLength; i++) {
            let row = document.createElement("tr");

			let qCell = document.createElement("td");
            qCell.textContent = summary.q_answered_list[i];
            row.appendChild(qCell);
            
            let seCell = document.createElement("td");
            seCell.textContent = summary.standard_error[i];
            row.appendChild(seCell);

            let infoCell = document.createElement("td");
            infoCell.textContent = summary.information[i];
            row.appendChild(infoCell);



            let correctCell = document.createElement("td");
            correctCell.textContent = summary.result_correctness_list[i];
            if (summary.result_correctness_list[i] == 1) {
                correctCell.style.color = 'green';
            } else if (summary.result_correctness_list[i] == 0) {
                correctCell.style.color = 'red';
            }
            row.appendChild(correctCell);

			let levelCell = document.createElement("td");
            levelCell.textContent = summary.student_level_list[i];
            row.appendChild(levelCell);

            tableBody.appendChild(row);
        }
    }
	// Add event listener for the new test button
    document.getElementById("new-test").addEventListener("click", () => {
        fetch('/api/reset', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => response.json())
        .then(() => {
            // Reset the frontend
            document.querySelector(".item-container").style.display = "";
            document.querySelector(".opt-container").style.display = "";
            document.getElementById("submit").style.display = "";
            document.getElementById("current-turn").style.display = "";
            document.getElementById("summary-section").style.display = "none";
            
            // Fetch initial data for the new test
            fetch('/api/data', {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(response => response.json())
            .then(data => {
                itemCode = data["data"];
                redrawItem(itemCode);
                resetSelection();
                updateTurn();
            });
        });
    });


</script>
